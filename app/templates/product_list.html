{% extends "layout.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>製品マスタ一覧</h2>
    <a href="{{ url_for('product.product_new') }}" class="btn btn-primary">新規登録</a>
</div>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="alert alert-{{ category }} mb-2">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
<table class="table table-bordered table-hover">
    <thead class="table-light">
        <tr>
            <th>製品名</th>
            <th>単価</th>
            <th>原価</th>
            <th>利益率</th>
            <th>備考</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for p in products %}
        <tr>
            <td>{{ p.name }}</td>
            <td>{{ '{:,.0f}'.format(p.unit_price) }}</td>
            <td>{{ '{:,.0f}'.format(p.cost or 0) }}</td>
            <td>
                {% set profit_rate = (p.unit_price - (p.cost or 0)) / p.unit_price if p.unit_price and p.unit_price > 0 else 0 %}
                {{ '{:.1f}%'.format(profit_rate * 100) }}
            </td>
            <td>{{ p.note or "" }}</td>
            <td>
                <a href="{{ url_for('product.product_edit', id=p.id) }}" class="btn btn-sm btn-secondary">編集</a>
                <form action="{{ url_for('product.product_delete', id=p.id) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('削除しますか？');">削除</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="6" class="text-center text-muted">製品データがありません。</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
